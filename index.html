<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProfitEarn - Earn Money Daily</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        :root {
            --primary: #8a2be2;
            --secondary: #4b0082;
            --accent: #9370db;
            --light: #f5f5f5;
            --dark: #333;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: var(--light);
            min-height: 100vh;
            padding-bottom: 70px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.5rem;
            font-weight: bold;
        }

        .logo i {
            color: var(--accent);
        }

        .balance {
            text-align: center;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .balance-amount {
            font-size: 2rem;
            font-weight: bold;
            margin: 10px 0;
        }

        .nav {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 10px;
        }

        .nav-item {
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            flex: 1;
            margin: 0 5px;
        }

        .nav-item.active {
            background: var(--primary);
        }

        .nav-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
            animation: fadeIn 0.5s;
        }

        .btn {
            background: linear-gradient(to right, var(--primary), var(--secondary));
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            margin: 10px 0;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
        }

        .btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.2);
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .feature-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            transition: all 0.3s;
        }

        .feature-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.15);
        }

        .feature-icon {
            font-size: 2rem;
            margin-bottom: 10px;
            color: var(--accent);
        }

        .feature-title {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .feature-desc {
            font-size: 0.8rem;
            opacity: 0.8;
        }

        .referral-box {
            display: flex;
            gap: 10px;
            margin: 15px 0;
        }

        .referral-input {
            flex: 1;
            padding: 12px;
            border-radius: 8px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .referral-input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        .copy-btn {
            background: var(--accent);
            color: white;
            border: none;
            padding: 0 15px;
            border-radius: 8px;
            cursor: pointer;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 20px 0;
        }

        .stat-card {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            margin: 5px 0;
        }

        .stat-label {
            font-size: 0.8rem;
            opacity: 0.8;
        }

        .wheel-container {
            position: relative;
            width: 250px;
            height: 250px;
            margin: 20px auto;
        }

        .wheel {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: conic-gradient(
                #ff6384, #36a2eb, #ffce56, #4bc0c0, 
                #9966ff, #ff9f40, #ff6384
            );
            position: relative;
            transition: transform 3s cubic-bezier(0.17, 0.67, 0.83, 0.67);
            transform: rotate(0deg);
        }

        .wheel-pointer {
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            width: 30px;
            height: 30px;
            background: var(--danger);
            clip-path: polygon(50% 100%, 0 0, 100% 0);
            z-index: 10;
        }

        .scratch-card {
            width: 100%;
            height: 200px;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            border-radius: 10px;
            margin: 20px 0;
            position: relative;
            overflow: hidden;
        }

        .scratch-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #333;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            cursor: pointer;
        }

        .timer {
            font-size: 2rem;
            text-align: center;
            margin: 20px 0;
            font-weight: bold;
        }

        .withdrawal-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .withdrawal-option {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .withdrawal-option:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-3px);
        }

        .withdrawal-amount {
            font-size: 1.2rem;
            font-weight: bold;
            margin: 5px 0;
        }

        .withdrawal-cost {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 100;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 15px;
            padding: 20px;
            width: 90%;
            max-width: 400px;
            text-align: center;
        }

        .modal-title {
            font-size: 1.5rem;
            margin-bottom: 15px;
        }

        .modal-input {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: none;
            margin: 10px 0;
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .modal-input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .modal-btn {
            flex: 1;
            padding: 10px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: bold;
        }

        .modal-btn.confirm {
            background: var(--success);
            color: white;
        }

        .modal-btn.cancel {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--success);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            box-shadow: var(--shadow);
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .toast.active {
            opacity: 1;
        }

        .auth-container {
            max-width: 400px;
            margin: 50px auto;
            padding: 20px;
        }

        .auth-tabs {
            display: flex;
            margin-bottom: 20px;
        }

        .auth-tab {
            flex: 1;
            text-align: center;
            padding: 10px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
        }

        .auth-tab.active {
            border-bottom: 2px solid var(--accent);
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-input {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .form-input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        .forgot-link {
            text-align: right;
            margin: 10px 0;
            font-size: 0.9rem;
            color: var(--accent);
            cursor: pointer;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .spinning {
            animation: spin 3s cubic-bezier(0.17, 0.67, 0.83, 0.67);
        }

        .footer {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: rgba(0, 0, 0, 0.5);
            padding: 10px;
            text-align: center;
            font-size: 0.8rem;
        }

        @media (max-width: 768px) {
            .feature-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .withdrawal-options {
                grid-template-columns: 1fr;
            }
            
            .stats {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Authentication Screen -->
    <div id="authScreen" class="container auth-container">
        <div class="card">
            <div class="logo" style="justify-content: center; margin-bottom: 20px;">
                <i class="fas fa-coins"></i>
                <span>ProfitEarn</span>
            </div>
            
            <div class="auth-tabs">
                <div class="auth-tab active" id="loginTab">Login</div>
                <div class="auth-tab" id="registerTab">Register</div>
            </div>
            
            <div class="auth-form active" id="loginForm">
                <div class="form-group">
                    <input type="email" id="loginEmail" class="form-input" placeholder="Email">
                </div>
                <div class="form-group">
                    <input type="password" id="loginPassword" class="form-input" placeholder="Password">
                </div>
                <div class="forgot-link" id="forgotPassword">Forgot Password?</div>
                <button class="btn" id="loginBtn">
                    <i class="fas fa-sign-in-alt"></i> Login
                </button>
            </div>
            
            <div class="auth-form" id="registerForm">
                <div class="form-group">
                    <input type="text" id="registerName" class="form-input" placeholder="Full Name">
                </div>
                <div class="form-group">
                    <input type="email" id="registerEmail" class="form-input" placeholder="Email">
                </div>
                <div class="form-group">
                    <input type="password" id="registerPassword" class="form-input" placeholder="Password">
                </div>
                <div class="form-group">
                    <input type="text" id="referralCode" class="form-input" placeholder="Referral Code (Optional)">
                </div>
                <button class="btn" id="registerBtn">
                    <i class="fas fa-user-plus"></i> Register
                </button>
            </div>
        </div>
    </div>

    <!-- Main App Screen -->
    <div id="appScreen" class="container" style="display: none;">
        <div class="header">
            <div class="logo">
                <i class="fas fa-coins"></i>
                <span>ProfitEarn</span>
            </div>
            <div class="user-info">
                <span id="userName">User</span>
                <button class="btn-secondary" id="logoutBtn" style="padding: 5px 10px; margin: 0; width: auto;">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </div>

        <div class="balance card">
            <div>Your Balance</div>
            <div class="balance-amount" id="balanceAmount">0 coins</div>
            <div>Earn more coins to redeem cash!</div>
        </div>

        <div class="nav">
            <div class="nav-item active" data-section="home">Home</div>
            <div class="nav-item" data-section="earn">Earn</div>
            <div class="nav-item" data-section="referral">Referral</div>
            <div class="nav-item" data-section="redeem">Redeem</div>
        </div>

        <!-- Home Section -->
        <div class="section active" id="homeSection">
            <div class="card">
                <h2>Welcome to ProfitEarn!</h2>
                <p>Earn coins daily through multiple methods and redeem them for real cash.</p>
                
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-label">Today's Earnings</div>
                        <div class="stat-value" id="todayEarnings">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Total Referrals</div>
                        <div class="stat-value" id="totalReferrals">0</div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>Quick Actions</h2>
                <div class="feature-grid">
                    <div class="feature-card" data-action="dailyBonus">
                        <div class="feature-icon">
                            <i class="fas fa-gift"></i>
                        </div>
                        <div class="feature-title">Daily Bonus</div>
                        <div class="feature-desc">20 coins daily</div>
                    </div>
                    <div class="feature-card" data-action="watchAd">
                        <div class="feature-icon">
                            <i class="fas fa-tv"></i>
                        </div>
                        <div class="feature-title">Watch Ad</div>
                        <div class="feature-desc">10 coins per ad</div>
                    </div>
                    <div class="feature-card" data-action="scratchCard">
                        <div class="feature-icon">
                            <i class="fas fa-scroll"></i>
                        </div>
                        <div class="feature-title">Scratch Card</div>
                        <div class="feature-desc">10 coins per card</div>
                    </div>
                    <div class="feature-card" data-action="spinWheel">
                        <div class="feature-icon">
                            <i class="fas fa-sync-alt"></i>
                        </div>
                        <div class="feature-title">Spin Wheel</div>
                        <div class="feature-desc">0-10 coins per spin</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Earn Section -->
        <div class="section" id="earnSection">
            <div class="card">
                <h2>Earning Methods</h2>
                
                <div class="earning-method">
                    <h3>Daily Bonus</h3>
                    <p>Claim 20 coins once every day</p>
                    <button class="btn" id="dailyBonusBtn">
                        <i class="fas fa-gift"></i> Claim Daily Bonus
                    </button>
                    <div class="method-info" id="dailyBonusInfo">Available</div>
                </div>
                
                <div class="earning-method">
                    <h3>Watch Ads</h3>
                    <p>Earn 10 coins per ad (Max 20 ads/day)</p>
                    <button class="btn" id="watchAdBtn">
                        <i class="fas fa-tv"></i> Watch Ad (10 coins)
                    </button>
                    <div class="method-info" id="watchAdInfo">0/20 ads watched today</div>
                </div>
                
                <div class="earning-method">
                    <h3>Scratch Cards</h3>
                    <p>Scratch to reveal 10 coins (Max 10/day)</p>
                    <div class="scratch-card">
                        <div class="scratch-overlay" id="scratchOverlay">
                            <i class="fas fa-hand-pointer"></i> Scratch Here
                        </div>
                    </div>
                    <div class="method-info" id="scratchCardInfo">0/10 scratches today</div>
                </div>
                
                <div class="earning-method">
                    <h3>Spin Wheel</h3>
                    <p>Spin to win 0-10 coins (Max 10 spins/day)</p>
                    <div class="wheel-container">
                        <div class="wheel-pointer"></div>
                        <div class="wheel" id="wheel"></div>
                    </div>
                    <button class="btn" id="spinWheelBtn">
                        <i class="fas fa-sync-alt"></i> Spin Wheel
                    </button>
                    <div class="method-info" id="spinWheelInfo">0/10 spins today</div>
                </div>
                
                <div class="earning-method">
                    <h3>Visit & Earn</h3>
                    <p>Visit our partner website and earn 30 coins (One-time)</p>
                    <button class="btn" id="visitEarnBtn">
                        <i class="fas fa-external-link-alt"></i> Visit Website
                    </button>
                    <div class="method-info" id="visitEarnInfo">Not claimed</div>
                </div>
            </div>
        </div>

        <!-- Referral Section -->
        <div class="section" id="referralSection">
            <div class="card">
                <h2>Refer & Earn</h2>
                <p>Invite friends and earn 50 coins when they join and earn their first coin!</p>
                
                <div class="referral-box">
                    <input type="text" id="referralCodeDisplay" class="referral-input" readonly value="Loading...">
                    <button class="copy-btn" id="copyReferralCode">
                        <i class="fas fa-copy"></i>
                    </button>
                </div>
                
                <div class="referral-box">
                    <input type="text" id="referralLink" class="referral-input" readonly value="Loading...">
                    <button class="copy-btn" id="copyReferralLink">
                        <i class="fas fa-copy"></i>
                    </button>
                </div>
                
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-label">Total Referrals</div>
                        <div class="stat-value" id="referralTotal">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Referral Earnings</div>
                        <div class="stat-value" id="referralEarnings">0</div>
                    </div>
                </div>
                
                <h3>How it works:</h3>
                <ul style="margin: 15px 0; padding-left: 20px;">
                    <li>Share your referral code or link with friends</li>
                    <li>They sign up using your code</li>
                    <li>You earn 50 coins when they earn their first coin</li>
                    <li>No limit on how many friends you can refer!</li>
                </ul>
            </div>
        </div>

        <!-- Redeem Section -->
        <div class="section" id="redeemSection">
            <div class="card">
                <h2>Redeem Coins for Cash</h2>
                <p>Convert your earned coins into real money through various methods</p>
                
                <div class="withdrawal-options">
                    <div class="withdrawal-option" data-amount="10" data-method="upi" data-cost="2000">
                        <div class="withdrawal-method">UPI</div>
                        <div class="withdrawal-amount">₹10</div>
                        <div class="withdrawal-cost">2000 coins</div>
                    </div>
                    <div class="withdrawal-option" data-amount="30" data-method="upi" data-cost="5000">
                        <div class="withdrawal-method">UPI</div>
                        <div class="withdrawal-amount">₹30</div>
                        <div class="withdrawal-cost">5000 coins</div>
                    </div>
                    <div class="withdrawal-option" data-amount="10" data-method="code" data-cost="2000">
                        <div class="withdrawal-method">Gift Code</div>
                        <div class="withdrawal-amount">₹10</div>
                        <div class="withdrawal-cost">2000 coins</div>
                    </div>
                    <div class="withdrawal-option" data-amount="30" data-method="code" data-cost="5000">
                        <div class="withdrawal-method">Gift Code</div>
                        <div class="withdrawal-amount">₹30</div>
                        <div class="withdrawal-cost">5000 coins</div>
                    </div>
                </div>
                
                <h3>Withdrawal History</h3>
                <div id="withdrawalHistory">
                    <p style="text-align: center; padding: 20px;">No withdrawal history yet</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div class="modal" id="adModal">
        <div class="modal-content">
            <div class="modal-title">Watch Ad to Earn Coins</div>
            <p>Please watch this ad to earn your reward</p>
            <div style="background: #000; color: white; padding: 20px; margin: 15px 0; border-radius: 8px; text-align: center;">
                <i class="fas fa-ad" style="font-size: 3rem; margin-bottom: 10px;"></i>
                <p>gotm ad code hear</p>
            </div>
            <div class="timer" id="adTimer">5</div>
            <button class="btn" id="closeAdBtn" disabled>Close Ad (5s)</button>
        </div>
    </div>

    <div class="modal" id="withdrawalModal">
        <div class="modal-content">
            <div class="modal-title" id="withdrawalTitle">Redeem Coins</div>
            <p id="withdrawalDesc">You are about to redeem <span id="withdrawalAmount">0</span> coins for ₹<span id="cashAmount">0</span></p>
            
            <div id="upiFields">
                <input type="text" id="upiId" class="modal-input" placeholder="Enter UPI ID">
            </div>
            
            <div id="emailFields" style="display: none;">
                <input type="email" id="emailAddress" class="modal-input" placeholder="Enter Gmail Address">
            </div>
            
            <div class="modal-buttons">
                <button class="modal-btn cancel" id="cancelWithdrawal">Cancel</button>
                <button class="modal-btn confirm" id="confirmWithdrawal">Confirm</button>
            </div>
        </div>
    </div>

    <div class="modal" id="visitModal">
        <div class="modal-content">
            <div class="modal-title">Visit & Earn</div>
            <p>Visit our partner website for 60 seconds to earn 30 coins</p>
            <div class="timer" id="visitTimer">60</div>
            <button class="btn" id="closeVisitBtn">Close</button>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>

    <!-- Footer -->
    <div class="footer">
        <p>ProfitEarn &copy; 2023 - Earn Money Daily</p>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCdLSGdmzccLLVnCFTUYsU9vTa3z_2T9DY",
            authDomain: "rupixo-adc5e.firebaseapp.com",
            databaseURL: "https://rupixo-adc5e-default-rtdb.firebaseio.com",
            projectId: "rupixo-adc5e",
            storageBucket: "rupixo-adc5e.firebasestorage.app",
            messagingSenderId: "79108214868",
            appId: "1:79108214868:web:507a557fdeb5de20d65dc1",
            measurementId: "G-F1D7GX94N1"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();

        // Global Variables
        let currentUser = null;
        let userData = null;
        let adTimerInterval = null;
        let visitTimerInterval = null;

        // DOM Elements
        const authScreen = document.getElementById('authScreen');
        const appScreen = document.getElementById('appScreen');
        const loginTab = document.getElementById('loginTab');
        const registerTab = document.getElementById('registerTab');
        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');
        const loginBtn = document.getElementById('loginBtn');
        const registerBtn = document.getElementById('registerBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const forgotPassword = document.getElementById('forgotPassword');
        const balanceAmount = document.getElementById('balanceAmount');
        const userName = document.getElementById('userName');
        const navItems = document.querySelectorAll('.nav-item');
        const sections = document.querySelectorAll('.section');
        const todayEarnings = document.getElementById('todayEarnings');
        const totalReferrals = document.getElementById('totalReferrals');
        const dailyBonusBtn = document.getElementById('dailyBonusBtn');
        const dailyBonusInfo = document.getElementById('dailyBonusInfo');
        const watchAdBtn = document.getElementById('watchAdBtn');
        const watchAdInfo = document.getElementById('watchAdInfo');
        const scratchOverlay = document.getElementById('scratchOverlay');
        const scratchCardInfo = document.getElementById('scratchCardInfo');
        const spinWheelBtn = document.getElementById('spinWheelBtn');
        const spinWheelInfo = document.getElementById('spinWheelInfo');
        const wheel = document.getElementById('wheel');
        const visitEarnBtn = document.getElementById('visitEarnBtn');
        const visitEarnInfo = document.getElementById('visitEarnInfo');
        const referralCodeDisplay = document.getElementById('referralCodeDisplay');
        const referralLink = document.getElementById('referralLink');
        const copyReferralCode = document.getElementById('copyReferralCode');
        const copyReferralLink = document.getElementById('copyReferralLink');
        const referralTotal = document.getElementById('referralTotal');
        const referralEarnings = document.getElementById('referralEarnings');
        const withdrawalOptions = document.querySelectorAll('.withdrawal-option');
        const withdrawalHistory = document.getElementById('withdrawalHistory');
        const adModal = document.getElementById('adModal');
        const adTimer = document.getElementById('adTimer');
        const closeAdBtn = document.getElementById('closeAdBtn');
        const withdrawalModal = document.getElementById('withdrawalModal');
        const withdrawalTitle = document.getElementById('withdrawalTitle');
        const withdrawalDesc = document.getElementById('withdrawalDesc');
        const withdrawalAmount = document.getElementById('withdrawalAmount');
        const cashAmount = document.getElementById('cashAmount');
        const upiFields = document.getElementById('upiFields');
        const emailFields = document.getElementById('emailFields');
        const cancelWithdrawal = document.getElementById('cancelWithdrawal');
        const confirmWithdrawal = document.getElementById('confirmWithdrawal');
        const visitModal = document.getElementById('visitModal');
        const visitTimer = document.getElementById('visitTimer');
        const closeVisitBtn = document.getElementById('closeVisitBtn');
        const toast = document.getElementById('toast');
        const featureCards = document.querySelectorAll('.feature-card');

        // Authentication State Listener
        auth.onAuthStateChanged((user) => {
            if (user) {
                currentUser = user;
                loadUserData();
                authScreen.style.display = 'none';
                appScreen.style.display = 'block';
            } else {
                currentUser = null;
                userData = null;
                authScreen.style.display = 'block';
                appScreen.style.display = 'none';
            }
        });

        // Authentication Functions
        loginTab.addEventListener('click', () => {
            loginTab.classList.add('active');
            registerTab.classList.remove('active');
            loginForm.classList.add('active');
            registerForm.classList.remove('active');
        });

        registerTab.addEventListener('click', () => {
            registerTab.classList.add('active');
            loginTab.classList.remove('active');
            registerForm.classList.add('active');
            loginForm.classList.remove('active');
        });

        loginBtn.addEventListener('click', () => {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            if (!email || !password) {
                showToast('Please fill all fields', 'error');
                return;
            }
            
            auth.signInWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    showToast('Login successful!', 'success');
                })
                .catch((error) => {
                    showToast(error.message, 'error');
                });
        });

        registerBtn.addEventListener('click', () => {
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const referralCode = document.getElementById('referralCode').value;
            
            if (!name || !email || !password) {
                showToast('Please fill all required fields', 'error');
                return;
            }
            
            auth.createUserWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    const user = userCredential.user;
                    const userId = user.uid;
                    const userRef = database.ref('users/' + userId);
                    
                    // Generate unique referral code
                    const generatedReferralCode = generateReferralCode();
                    
                    const userData = {
                        name: name,
                        email: email,
                        coins: 100, // Starting bonus
                        joinDate: Date.now(),
                        lastBonusClaim: null,
                        adsWatchedToday: 0,
                        scratchesToday: 0,
                        withdrawalHistory: [],
                        referralCode: generatedReferralCode,
                        totalReferrals: 0,
                        referralEarnings: 0,
                        userId: userId,
                        hasVisited: false,
                        lastSpin: null,
                        spinsToday: 0
                    };
                    
                    // If referral code was provided, process it
                    if (referralCode) {
                        processReferral(referralCode, userId);
                    }
                    
                    return userRef.set(userData);
                })
                .then(() => {
                    showToast('Registration successful!', 'success');
                })
                .catch((error) => {
                    showToast(error.message, 'error');
                });
        });

        logoutBtn.addEventListener('click', () => {
            auth.signOut()
                .then(() => {
                    showToast('Logged out successfully', 'success');
                })
                .catch((error) => {
                    showToast(error.message, 'error');
                });
        });

        forgotPassword.addEventListener('click', () => {
            const email = document.getElementById('loginEmail').value;
            
            if (!email) {
                showToast('Please enter your email address', 'error');
                return;
            }
            
            auth.sendPasswordResetEmail(email)
                .then(() => {
                    showToast('Password reset email sent!', 'success');
                })
                .catch((error) => {
                    showToast(error.message, 'error');
                });
        });

        // Navigation
        navItems.forEach(item => {
            item.addEventListener('click', () => {
                const sectionId = item.getAttribute('data-section');
                
                navItems.forEach(nav => nav.classList.remove('active'));
                sections.forEach(section => section.classList.remove('active'));
                
                item.classList.add('active');
                document.getElementById(sectionId + 'Section').classList.add('active');
            });
        });

        // Feature Cards
        featureCards.forEach(card => {
            card.addEventListener('click', () => {
                const action = card.getAttribute('data-action');
                
                switch(action) {
                    case 'dailyBonus':
                        claimDailyBonus();
                        break;
                    case 'watchAd':
                        watchAd();
                        break;
                    case 'scratchCard':
                        openScratchCard();
                        break;
                    case 'spinWheel':
                        spinWheel();
                        break;
                }
            });
        });

        // Earning Methods
        dailyBonusBtn.addEventListener('click', claimDailyBonus);
        
        watchAdBtn.addEventListener('click', watchAd);
        
        scratchOverlay.addEventListener('click', openScratchCard);
        
        spinWheelBtn.addEventListener('click', spinWheel);
        
        visitEarnBtn.addEventListener('click', () => {
            if (userData && userData.hasVisited) {
                showToast('You have already claimed the visit bonus', 'error');
                return;
            }
            
            visitModal.classList.add('active');
            let timeLeft = 60;
            visitTimer.textContent = timeLeft;
            
            visitTimerInterval = setInterval(() => {
                timeLeft--;
                visitTimer.textContent = timeLeft;
                
                if (timeLeft <= 0) {
                    clearInterval(visitTimerInterval);
                    claimVisitBonus();
                }
            }, 1000);
        });

        // Referral System
        copyReferralCode.addEventListener('click', () => {
            copyToClipboard(referralCodeDisplay.value);
            showToast('Referral code copied!', 'success');
        });

        copyReferralLink.addEventListener('click', () => {
            copyToClipboard(referralLink.value);
            showToast('Referral link copied!', 'success');
        });

        // Withdrawal System
        withdrawalOptions.forEach(option => {
            option.addEventListener('click', () => {
                const amount = option.getAttribute('data-amount');
                const method = option.getAttribute('data-method');
                const cost = option.getAttribute('data-cost');
                
                if (userData.coins < cost) {
                    showToast(`You need ${cost} coins to redeem ₹${amount}`, 'error');
                    return;
                }
                
                withdrawalTitle.textContent = `Redeem ₹${amount}`;
                withdrawalDesc.textContent = `You are about to redeem ${cost} coins for ₹${amount}`;
                withdrawalAmount.textContent = cost;
                cashAmount.textContent = amount;
                
                if (method === 'upi') {
                    upiFields.style.display = 'block';
                    emailFields.style.display = 'none';
                } else {
                    upiFields.style.display = 'none';
                    emailFields.style.display = 'block';
                }
                
                withdrawalModal.classList.add('active');
                
                // Store withdrawal details for confirmation
                withdrawalModal.setAttribute('data-amount', amount);
                withdrawalModal.setAttribute('data-method', method);
                withdrawalModal.setAttribute('data-cost', cost);
            });
        });

        cancelWithdrawal.addEventListener('click', () => {
            withdrawalModal.classList.remove('active');
        });

        confirmWithdrawal.addEventListener('click', () => {
            const amount = withdrawalModal.getAttribute('data-amount');
            const method = withdrawalModal.getAttribute('data-method');
            const cost = parseInt(withdrawalModal.getAttribute('data-cost'));
            
            let contactInfo = '';
            if (method === 'upi') {
                contactInfo = document.getElementById('upiId').value;
                if (!contactInfo) {
                    showToast('Please enter your UPI ID', 'error');
                    return;
                }
            } else {
                contactInfo = document.getElementById('emailAddress').value;
                if (!contactInfo) {
                    showToast('Please enter your email address', 'error');
                    return;
                }
            }
            
            // Process withdrawal
            processWithdrawal(amount, method, cost, contactInfo);
            withdrawalModal.classList.remove('active');
        });

        // Ad Modal
        closeAdBtn.addEventListener('click', () => {
            adModal.classList.remove('active');
            clearInterval(adTimerInterval);
            
            // Add coins after watching ad
            if (userData) {
                const newCoins = userData.coins + 10;
                const newAdsWatched = userData.adsWatchedToday + 1;
                
                database.ref('users/' + currentUser.uid).update({
                    coins: newCoins,
                    adsWatchedToday: newAdsWatched
                }).then(() => {
                    showToast('+10 coins for watching ad!', 'success');
                    loadUserData();
                });
            }
        });

        // Visit Modal
        closeVisitBtn.addEventListener('click', () => {
            visitModal.classList.remove('active');
            clearInterval(visitTimerInterval);
        });

        // Utility Functions
        function loadUserData() {
            if (!currentUser) return;
            
            database.ref('users/' + currentUser.uid).on('value', (snapshot) => {
                userData = snapshot.val();
                if (userData) {
                    updateUI();
                }
            });
        }

        function updateUI() {
            balanceAmount.textContent = userData.coins + ' coins';
            userName.textContent = userData.name;
            todayEarnings.textContent = calculateTodayEarnings();
            totalReferrals.textContent = userData.totalReferrals;
            
            // Update referral section
            referralCodeDisplay.value = userData.referralCode;
            referralLink.value = `https://profitaindia.github.io/profta/?ref=${userData.referralCode}`;
            referralTotal.textContent = userData.totalReferrals;
            referralEarnings.textContent = userData.referralEarnings;
            
            // Update earning methods status
            updateEarningMethodsStatus();
            
            // Update withdrawal history
            updateWithdrawalHistory();
        }

        function updateEarningMethodsStatus() {
            // Daily Bonus
            const today = new Date().toDateString();
            const lastClaimDate = userData.lastBonusClaim ? new Date(userData.lastBonusClaim).toDateString() : null;
            
            if (lastClaimDate === today) {
                dailyBonusBtn.disabled = true;
                dailyBonusInfo.textContent = 'Already claimed today';
            } else {
                dailyBonusBtn.disabled = false;
                dailyBonusInfo.textContent = 'Available to claim';
            }
            
            // Watch Ads
            if (userData.adsWatchedToday >= 20) {
                watchAdBtn.disabled = true;
                watchAdInfo.textContent = 'Limit reached (20/20)';
            } else {
                watchAdBtn.disabled = false;
                watchAdInfo.textContent = `${userData.adsWatchedToday}/20 ads watched today`;
            }
            
            // Scratch Cards
            if (userData.scratchesToday >= 10) {
                scratchOverlay.style.cursor = 'not-allowed';
                scratchCardInfo.textContent = 'Limit reached (10/10)';
            } else {
                scratchOverlay.style.cursor = 'pointer';
                scratchCardInfo.textContent = `${userData.scratchesToday}/10 scratches today`;
            }
            
            // Spin Wheel
            if (userData.spinsToday >= 10) {
                spinWheelBtn.disabled = true;
                spinWheelInfo.textContent = 'Limit reached (10/10)';
            } else {
                spinWheelBtn.disabled = false;
                spinWheelInfo.textContent = `${userData.spinsToday}/10 spins today`;
            }
            
            // Visit & Earn
            if (userData.hasVisited) {
                visitEarnBtn.disabled = true;
                visitEarnInfo.textContent = 'Already claimed';
            } else {
                visitEarnBtn.disabled = false;
                visitEarnInfo.textContent = 'Not claimed yet';
            }
        }

        function updateWithdrawalHistory() {
            if (!userData.withdrawalHistory || userData.withdrawalHistory.length === 0) {
                withdrawalHistory.innerHTML = '<p style="text-align: center; padding: 20px;">No withdrawal history yet</p>';
                return;
            }
            
            let historyHTML = '';
            userData.withdrawalHistory.forEach(withdrawal => {
                const date = new Date(withdrawal.date).toLocaleDateString();
                historyHTML += `
                    <div class="withdrawal-item" style="background: rgba(255,255,255,0.1); padding: 10px; border-radius: 8px; margin-bottom: 10px;">
                        <div style="display: flex; justify-content: space-between;">
                            <div>₹${withdrawal.amount} via ${withdrawal.method}</div>
                            <div>${date}</div>
                        </div>
                        <div style="font-size: 0.8rem; opacity: 0.8;">Status: ${withdrawal.status}</div>
                    </div>
                `;
            });
            
            withdrawalHistory.innerHTML = historyHTML;
        }

        function calculateTodayEarnings() {
            // This would need more complex logic based on actual transactions
            // For now, we'll return a simple calculation
            let earnings = 0;
            
            // Daily bonus if claimed today
            const today = new Date().toDateString();
            const lastClaimDate = userData.lastBonusClaim ? new Date(userData.lastBonusClaim).toDateString() : null;
            if (lastClaimDate === today) earnings += 20;
            
            // Ads watched today
            earnings += userData.adsWatchedToday * 10;
            
            // Scratches today
            earnings += userData.scratchesToday * 10;
            
            // Spins today (approximate average)
            earnings += userData.spinsToday * 5;
            
            return earnings;
        }

        function claimDailyBonus() {
            if (!userData) return;
            
            const today = new Date().toDateString();
            const lastClaimDate = userData.lastBonusClaim ? new Date(userData.lastBonusClaim).toDateString() : null;
            
            if (lastClaimDate === today) {
                showToast('You have already claimed your daily bonus today', 'error');
                return;
            }
            
            const newCoins = userData.coins + 20;
            
            database.ref('users/' + currentUser.uid).update({
                coins: newCoins,
                lastBonusClaim: Date.now()
            }).then(() => {
                showToast('+20 coins daily bonus claimed!', 'success');
                loadUserData();
            });
        }

        function watchAd() {
            if (!userData) return;
            
            if (userData.adsWatchedToday >= 20) {
                showToast('You have reached the daily limit for watching ads', 'error');
                return;
            }
            
            // Show ad modal
            adModal.classList.add('active');
            let timeLeft = 5;
            adTimer.textContent = timeLeft;
            closeAdBtn.disabled = true;
            closeAdBtn.textContent = `Close Ad (${timeLeft}s)`;
            
            adTimerInterval = setInterval(() => {
                timeLeft--;
                adTimer.textContent = timeLeft;
                closeAdBtn.textContent = `Close Ad (${timeLeft}s)`;
                
                if (timeLeft <= 0) {
                    clearInterval(adTimerInterval);
                    closeAdBtn.disabled = false;
                    closeAdBtn.textContent = 'Close Ad';
                }
            }, 1000);
        }

        function openScratchCard() {
            if (!userData) return;
            
            if (userData.scratchesToday >= 10) {
                showToast('You have reached the daily limit for scratch cards', 'error');
                return;
            }
            
            // In a real app, this would be an actual scratch card implementation
            // For this demo, we'll just award the coins directly
            const newCoins = userData.coins + 10;
            const newScratches = userData.scratchesToday + 1;
            
            database.ref('users/' + currentUser.uid).update({
                coins: newCoins,
                scratchesToday: newScratches
            }).then(() => {
                showToast('+10 coins from scratch card!', 'success');
                loadUserData();
            });
        }

        function spinWheel() {
            if (!userData) return;
            
            if (userData.spinsToday >= 10) {
                showToast('You have reached the daily limit for spins', 'error');
                return;
            }
            
            // Show ad before spin
            watchAd();
            
            // After ad is closed, perform the spin
            const originalCloseHandler = closeAdBtn.onclick;
            closeAdBtn.onclick = () => {
                originalCloseHandler();
                
                // Perform the spin
                const spinResult = Math.floor(Math.random() * 11); // 0-10 coins
                const newCoins = userData.coins + spinResult;
                const newSpins = userData.spinsToday + 1;
                
                database.ref('users/' + currentUser.uid).update({
                    coins: newCoins,
                    spinsToday: newSpins,
                    lastSpin: Date.now()
                }).then(() => {
                    // Animate the wheel
                    wheel.classList.add('spinning');
                    setTimeout(() => {
                        wheel.classList.remove('spinning');
                        showToast(`+${spinResult} coins from spin wheel!`, 'success');
                        loadUserData();
                    }, 3000);
                });
                
                // Reset the onclick handler
                closeAdBtn.onclick = originalCloseHandler;
            };
        }

        function claimVisitBonus() {
            if (!userData) return;
            
            if (userData.hasVisited) {
                showToast('You have already claimed the visit bonus', 'error');
                return;
            }
            
            const newCoins = userData.coins + 30;
            
            database.ref('users/' + currentUser.uid).update({
                coins: newCoins,
                hasVisited: true
            }).then(() => {
                showToast('+30 coins for visiting our partner site!', 'success');
                loadUserData();
                visitModal.classList.remove('active');
            });
        }

        function processWithdrawal(amount, method, cost, contactInfo) {
            if (!userData) return;
            
            if (userData.coins < cost) {
                showToast(`You don't have enough coins to redeem ₹${amount}`, 'error');
                return;
            }
            
            const newCoins = userData.coins - cost;
            const withdrawal = {
                amount: amount,
                method: method,
                cost: cost,
                contact: contactInfo,
                date: Date.now(),
                status: 'Processing'
            };
            
            const updatedWithdrawalHistory = userData.withdrawalHistory ? 
                [...userData.withdrawalHistory, withdrawal] : [withdrawal];
            
            database.ref('users/' + currentUser.uid).update({
                coins: newCoins,
                withdrawalHistory: updatedWithdrawalHistory
            }).then(() => {
                showToast(`Withdrawal request for ₹${amount} submitted! It will be processed within 24 hours.`, 'success');
                loadUserData();
            });
        }

        function processReferral(referralCode, newUserId) {
            // Find user with this referral code
            database.ref('users').orderByChild('referralCode').equalTo(referralCode).once('value')
                .then(snapshot => {
                    if (snapshot.exists()) {
                        const data = snapshot.val();
                        const referrerId = Object.keys(data)[0];
                        const referrerData = data[referrerId];
                        
                        // Update referrer's data
                        const newTotalReferrals = referrerData.totalReferrals + 1;
                        database.ref('users/' + referrerId).update({
                            totalReferrals: newTotalReferrals
                        });
                        
                        // Award 50 coins when the new user earns their first coin
                        // This would be triggered when the new user completes their first earning action
                    }
                });
        }

        function generateReferralCode() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let result = '';
            for (let i = 0; i < 8; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result;
        }

        function copyToClipboard(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
        }

        function showToast(message, type) {
            toast.textContent = message;
            toast.className = 'toast';
            
            if (type === 'success') {
                toast.style.background = 'var(--success)';
            } else if (type === 'error') {
                toast.style.background = 'var(--danger)';
            } else {
                toast.style.background = 'var(--primary)';
            }
            
            toast.classList.add('active');
            
            setTimeout(() => {
                toast.classList.remove('active');
            }, 3000);
        }

        // Reset daily limits at midnight
        function resetDailyLimits() {
            if (!currentUser || !userData) return;
            
            const now = new Date();
            const lastReset = userData.lastReset || 0;
            const lastResetDate = new Date(lastReset);
            
            // Check if it's a new day
            if (now.toDateString() !== lastResetDate.toDateString()) {
                database.ref('users/' + currentUser.uid).update({
                    adsWatchedToday: 0,
                    scratchesToday: 0,
                    spinsToday: 0,
                    lastReset: Date.now()
                });
            }
        }

        // Check for reset on page load and every minute
        setInterval(resetDailyLimits, 60000);
    </script>
</body>
</html>
